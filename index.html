<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Gh√©p h√¨nh tr√°i tim üíñ</title>
<style>
  body {
    margin: 0;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
    background: #f9fafb;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
  }
  h1 {margin-bottom: 12px;}
  .board {
    position: relative;
    width: 700px;
    height: 700px;
    background: #fff;
    border: 3px solid #ddd;
    border-radius: 20px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.1);
    overflow: hidden;
    background-image: url("puzzle.png");
    background-size: cover;
    background-position: center;
    transition: opacity 0.3s;
  }
  .slot {
    position: absolute;
    border: 2px dashed transparent;
    transition: border-color 0.2s;
  }
  .slot.correct {border-color: #22c55e;}
  .tray {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 20px;
    justify-content: center;
    max-width: 720px;
  }
  .piece {
    width: 130px;
    height: 130px;
    object-fit: contain;
    cursor: grab;
    user-select: none;
  }
  .ghost {
    position: fixed;
    pointer-events: none;
    z-index: 1000;
    width: 130px;
    height: 130px;
    object-fit: contain;
    opacity: 0.9;
    transform: scale(1.1);
  }
  button {
    margin: 8px;
    padding: 8px 14px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    color: white;
    background: #3b82f6;
  }
  button.secondary { background: #64748b; }
  @media (max-width:700px){
    .board{width:90vw;height:90vw;}
    .piece{width:22vw;height:22vw;}
  }
</style>
</head>
<body>
<h1>üß© Gh√©p h√¨nh tr√°i tim üíñ</h1>
<div class="board" id="board"></div>
<div class="tray" id="tray"></div>
<div>
  <button id="shuffle">X√°o tr·ªôn</button>
  <button id="reset" class="secondary">ƒê·∫∑t l·∫°i</button>
  <button id="toggle" class="secondary">Hi·ªán / ·∫©n ·∫£nh g·ªëc</button>
</div>

<script>
const BG = "puzzle.png";
const PIECES = Array.from({length:14},(_,i)=>`p${i+1}.png`);

// layout t·∫°m th·ªùi theo d√°ng tr√°i tim (to·∫° ƒë·ªô t∆∞∆°ng ƒë·ªëi)
const TARGETS = [
  {x:0.05,y:0.15,w:0.22,h:0.20}, // p1
  {x:0.05,y:0.36,w:0.22,h:0.20}, // p2
  {x:0.05,y:0.57,w:0.22,h:0.20}, // p3

  {x:0.28,y:0.05,w:0.22,h:0.18}, // p4
  {x:0.28,y:0.24,w:0.22,h:0.18}, // p5
  {x:0.28,y:0.43,w:0.22,h:0.18}, // p6
  {x:0.28,y:0.62,w:0.22,h:0.18}, // p7

  {x:0.50,y:0.05,w:0.22,h:0.18}, // p8
  {x:0.50,y:0.24,w:0.22,h:0.18}, // p9
  {x:0.50,y:0.43,w:0.22,h:0.18}, // p10
  {x:0.50,y:0.62,w:0.22,h:0.18}, // p11

  {x:0.72,y:0.15,w:0.22,h:0.20}, // p12
  {x:0.72,y:0.36,w:0.22,h:0.20}, // p13
  {x:0.72,y:0.57,w:0.22,h:0.20}, // p14
];

const board = document.getElementById("board");
const tray = document.getElementById("tray");

// t·∫°o slot v·ªã tr√≠
const slots = TARGETS.map((t,i)=>{
  const div=document.createElement("div");
  div.className="slot";
  div.dataset.index=i;
  Object.assign(div.style,{
    left:`${t.x*100}%`,
    top:`${t.y*100}%`,
    width:`${t.w*100}%`,
    height:`${t.h*100}%`
  });
  board.appendChild(div);
  return div;
});

let pieces=[];

function createPieces(){
  tray.innerHTML="";
  pieces = PIECES.map((src,i)=>{
    const img=document.createElement("img");
    img.src=src;
    img.className="piece";
    img.dataset.index=i;
    tray.appendChild(img);
    makeDraggable(img);
    return img;
  });
}

let dragging=null, ghost=null, offset={x:0,y:0};

function makeDraggable(img){
  img.addEventListener("pointerdown",e=>{
    e.preventDefault();
    dragging=img;
    const r=img.getBoundingClientRect();
    offset.x=e.clientX-r.left;
    offset.y=e.clientY-r.top;
    ghost=img.cloneNode();
    ghost.className="ghost";
    document.body.appendChild(ghost);
    moveGhost(e);
    window.addEventListener("pointermove",moveGhost);
    window.addEventListener("pointerup",dropPiece);
  });
}

function moveGhost(e){
  if(!ghost) return;
  ghost.style.left=e.clientX-offset.x+"px";
  ghost.style.top=e.clientY-offset.y+"px";
}

function dropPiece(e){
  if(!dragging) return;
  const rectBoard=board.getBoundingClientRect();
  const x=e.clientX-rectBoard.left;
  const y=e.clientY-rectBoard.top;
  let best=null,min=Infinity;
  slots.forEach((s,i)=>{
    const r=s.getBoundingClientRect();
    const cx=r.left+r.width/2,cy=r.top+r.height/2;
    const d=Math.hypot(e.clientX-cx,e.clientY-cy);
    if(d<min){min=d;best={slot:s,i};}
  });
  if(best&&min<80&&!best.slot.dataset.filled){
    placePiece(dragging,best.slot,best.i);
  }
  ghost.remove();
  ghost=null; dragging=null;
  window.removeEventListener("pointermove",moveGhost);
  window.removeEventListener("pointerup",dropPiece);
}

function placePiece(img,slot,index){
  slot.dataset.filled="1";
  const p=document.createElement("img");
  p.src=img.src;
  p.className="piece";
  p.style.position="absolute";
  Object.assign(p.style,{
    left:slot.style.left,
    top:slot.style.top,
    width:slot.style.width,
    height:slot.style.height,
    objectFit:"contain",
    pointerEvents:"none"
  });
  board.appendChild(p);
  slot.classList.add("correct");
  img.style.visibility="hidden";
  checkWin();
}

function checkWin(){
  const filled=slots.filter(s=>s.dataset.filled).length;
  if(filled===PIECES.length){
    setTimeout(()=>alert("üéâ Tuy·ªát v·ªùi! B·∫°n ƒë√£ gh√©p xong tr√°i tim üíñ"),200);
  }
}

// n√∫t ch·ª©c nƒÉng
document.getElementById("shuffle").onclick=()=>{
  const arr=[...tray.children];
  arr.sort(()=>Math.random()-0.5).forEach(c=>tray.appendChild(c));
};
document.getElementById("reset").onclick=()=>{
  tray.querySelectorAll("img").forEach(i=>i.style.visibility="visible");
  board.querySelectorAll(".piece").forEach(p=>p.remove());
  slots.forEach(s=>{s.classList.remove("correct");delete s.dataset.filled;});
};
let show=true;
document.getElementById("toggle").onclick=()=>{
  show=!show;
  board.style.opacity=show?1:0.1;
};

createPieces();
</script>
</body>
</html>
