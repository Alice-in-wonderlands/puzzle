<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>X·∫øp H√¨nh Tr√°i Tim To</title>
  <style>
    :root {
      --size: 450px; /* üíñ k√≠ch th∆∞·ªõc t·ªïng th·ªÉ khung tr√°i tim */
      --cell: calc(var(--size) / 3);
    }

    body {
      font-family: "Segoe UI", Roboto, sans-serif;
      background: #fff5f9;
      color: #333;
      display: flex;
      flex-direction: column;
      gap: 16px;
      align-items: center;
      padding: 30px;
    }

    h1 {
      color: #d6336c;
      margin: 0;
      font-size: 2rem;
    }

    p {
      margin: 0 0 12px 0;
    }

    /* Board h√¨nh tr√°i tim */
    .board-wrap {
      width: var(--size);
      height: var(--size);
      position: relative;
      clip-path: polygon(
        50% 90%,
        10% 55%,
        10% 30%,
        30% 10%,
        50% 30%,
        70% 10%,
        90% 30%,
        90% 55%
      );
      background: linear-gradient(180deg, #fff, #ffeaf2);
      border: 3px solid #ffb5ce;
      box-shadow: 0 6px 20px rgba(214, 51, 108, 0.15);
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(3, 1fr);
      gap: 0;
    }

    .slot {
      width: 100%;
      height: 100%;
      border: 1px dashed rgba(150,150,150,0.25);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      background: transparent;
    }

    .slot.highlight {
      outline: 3px dashed rgba(214,51,108,0.45);
    }

    /* v√πng ch·ª©a m·∫£nh */
    #pieces {
      width: var(--size);
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      justify-content: center;
    }

    .piece {
      width: var(--cell);
      height: var(--cell);
      box-sizing: border-box;
      border: 1px solid #888;
      background-image: url("sa1.jpg");
      background-size: var(--size) var(--size);
      cursor: grab;
      user-select: none;
      border-radius: 4px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.15);
    }

    .slot .piece {
      width: 100%;
      height: 100%;
      border: none;
      cursor: default;
      box-shadow: none;
    }

    button {
      background:#d6336c;
      color:white;
      border:none;
      padding:10px 16px;
      border-radius:6px;
      cursor:pointer;
      font-size: 1rem;
    }

    button:hover {
      background:#b72559;
    }
  </style>
</head>
<body>
  <h1>üß© X·∫øp H√¨nh Tr√°i Tim To</h1>
  <p>K√©o c√°c m·∫£nh v√†o khung tr√°i tim ƒë·ªÉ ho√†n th√†nh h√¨nh nh√© üíó</p>

  <div class="board-wrap" id="board"></div>
  <div id="pieces"></div>

  <div style="margin-top:12px;">
    <button id="shuffleBtn">üîÄ X√°o l·∫°i m·∫£nh</button>
    <button id="resetBtn">‚ôªÔ∏è ƒê·∫∑t l·∫°i</button>
  </div>

  <script>
    const board = document.getElementById("board");
    const piecesContainer = document.getElementById("pieces");
    const gridSize = 3;
    const boardSize = 450; // üíñ l·ªõn h∆°n
    const cellSize = boardSize / gridSize;

    function createSlots() {
      board.innerHTML = "";
      for (let i = 0; i < gridSize * gridSize; i++) {
        const slot = document.createElement("div");
        slot.className = "slot";
        slot.dataset.index = i;
        slot.addEventListener("dragover", (e) => {
          e.preventDefault();
          slot.classList.add("highlight");
        });
        slot.addEventListener("dragleave", () => slot.classList.remove("highlight"));
        slot.addEventListener("drop", handleDrop);
        board.appendChild(slot);
      }
    }

    function createPieces(shuffle = true) {
      piecesContainer.innerHTML = "";
      const positions = [];
      for (let r = 0; r < gridSize; r++) {
        for (let c = 0; c < gridSize; c++) {
          positions.push({ r, c, idx: r * gridSize + c });
        }
      }

      if (shuffle) {
        for (let i = positions.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [positions[i], positions[j]] = [positions[j], positions[i]];
        }
      }

      positions.forEach((pos, i) => {
        const piece = document.createElement("div");
        piece.className = "piece";
        piece.id = "p-" + i;
        piece.style.backgroundPosition = `-${pos.c * cellSize}px -${pos.r * cellSize}px`;
        piece.dataset.correctIndex = pos.idx;
        piece.draggable = true;

        piece.addEventListener("dragstart", (e) => {
          e.dataTransfer.setData("text/plain", piece.id);
          e.dataTransfer.effectAllowed = "move";
        });

        piecesContainer.appendChild(piece);
      });
    }

    function handleDrop(e) {
      e.preventDefault();
      this.classList.remove("highlight");
      const pieceId = e.dataTransfer.getData("text/plain");
      const dragged = document.getElementById(pieceId);
      if (!dragged) return;
      if (this.querySelector(".piece")) return;
      this.appendChild(dragged);
      checkWin();
    }

    function checkWin() {
      const slots = board.querySelectorAll(".slot");
      let win = true;
      slots.forEach((slot, idx) => {
        const piece = slot.querySelector(".piece");
        if (!piece || parseInt(piece.dataset.correctIndex, 10) !== idx) {
          win = false;
        }
      });
      if (win) {
        setTimeout(() => alert("üéâ B·∫°n ƒë√£ gh√©p xong h√¨nh tr√°i tim r·ªìi!"), 100);
      }
    }

    document.getElementById("shuffleBtn").addEventListener("click", () => createPieces(true));
    document.getElementById("resetBtn").addEventListener("click", () => { createSlots(); createPieces(false); });

    createSlots();
    createPieces(true);
  </script>
</body>
</html>
